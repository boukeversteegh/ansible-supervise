- name: ensuring directories for {{ name }}
  file: path={{ item }} state=directory
  with_items: app_dirs

- name: installing config for {{ name }}
  template: src=app.ini.j2 dest={{ supervisor_home }}/conf.d/{{ name }}.ini
  register: app_conf

- name: starting {{ name }}
  supervisorctl: name={{ name }} state=present {{ super_args }}
  register: app_started

- name: reloading configuration for {{ name }}
  when: app_conf|changed and not app_started|changed
  shell: >
    {{ supervisorctl_path }} -c {{ supervisor_config }} reread;
    {{ supervisorctl_path }} -c {{ supervisor_config }} update {{ name }}
